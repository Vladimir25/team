Архитектура
========

> Хорошая архитектура - это дорого. 
> Плохая архитектура - еще дороже.
> 
> *Александр Макаров*

Чтобы уложить в мозг работу системы, необходимо разделить систему на доменные сущности и слои.

## Понятия

* Домен - сущности и действия реального мира, которые нужно моделировать
* Единый язык домена - набор терминов, применяемых в модели домена для объяснения связей и действий

## Что такое архитектура?

* Это ряд решений о том, как взаимодействуют отдельные части системы.
* Архитектура описывает интерфейсы, контракты и абстракцию.

## Цели

* борьба со сложностью
* сделать понятным каждый уровень абстракции

Борьба со сложностью достигается разбиением кода на отдельные элементы и описанием их интерфейсов.
Код становится легче использовать тестировать.

## Правила

* низший слой не знает о высшем
* служащие одной цели классы обединяются в пакеты (логические рамки)
* доменный слой не зависит ни от чего

## Что описывать

* структура компонентов
* взаимодействие компонентов
* размещение

## Слои

В проекте используется архитектура MVC.
 
* M - модель
* V - вид
* C - контроллер

### Модель

Модель - это не Active Record в чистом виде, а совокупность слоев, обеспечивающая работу моделью из реального мира.

Модель имеет слои:

* Домен
* Сервис
* Сущность
* Хранилище

Интерфейс модели знают контроллер и представление.

Модель не знает о контроллерах и представлениях.

### Вид

Вид принимает данные от контроллера, форматирует как нужно и отправляет клиенту.

Обеспечивает интерфейс для клиента.

Вид может знать только о интерфейсе модели.

### Контроллер

Контроллер 

* собирает данные из окружения
* принимает параметры ()GET, POST, HEADER, COOKIE, SESSION) и передает их куда требуется
* взаимодействует сервисами
* взимодействует с представлением

АПИ контроллер имеет те же пункты, кроме представления. 
Представление заменяется сериализатором данных (JSON, XML).

Контроллер знает об интерфейсе модели и знает о представлениях.

## Общая схема

```
Интерфейс
|
V
Сервис -> Сущность
|
V
Хранилище
```

## Жирная модель или жирный контроллер?

Логику держим в сервисах, вызываем методы сервисов из контроллеров. 
Суть в том, что мы можем вызывать один и тот же бизнесс-процесс из разных мест.

Если есть жирная модель или контроллер, то разносим логику по слоям.

Если говорить об `active record` моделях, то они занимают инфраструктурный слой, используются как удобная прослойка для работы с БД.
Так же, этим может заниматься `query builder`.
